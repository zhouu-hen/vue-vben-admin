var Le=Object.defineProperty;var Ae=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ve=(e,i,o)=>i in e?Le(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o,O=(e,i)=>{for(var o in i||(i={}))Pe.call(i,o)&&ve(e,o,i[o]);if(Ae)for(var o of Ae(i))Me.call(i,o)&&ve(e,o,i[o]);return e};var D=(e,i,o)=>new Promise((m,b)=>{var h=u=>{try{c(o.next(u))}catch(f){b(f)}},l=u=>{try{c(o.throw(u))}catch(f){b(f)}},c=u=>u.done?m(u.value):Promise.resolve(u.value).then(h,l);c((o=o.apply(e,i)).next())});import{bi as Ne,bh as ke,a as Te,cW as _e,cX as xe,aE as B,f as _,au as De,c as ze,aw as Y,o as q,j as X,z as x,i as Ye,n as re,aA as H,ax as ee,B as le,t as ue,l as se,bm as He,aB as ae,br as W,cY as te,av as ce,k as n,aF as ie,cZ as pe,c_ as K,c$ as me,ah as G,aL as We,cR as Ue,a7 as Q,d0 as qe,cz as Ge,bt as Ce,bq as Xe,al as be,am as ge,d1 as Be,d2 as Fe,d3 as Ve,d4 as Ke,L as Je,w as we,v as Z,b as Ze,N as Qe,h as et,az as fe,F as tt,ay as Oe,aC as de,D as nt}from"./index.05b57da0.js";/* empty css              *//* empty css              */import{d as ot,h as st,a as je,_ as at}from"./FormItem.vue_vue_type_script_lang.9eb58eb7.js";import"./index.d3c0d16e.js";import{F as $e}from"./Form.5be812f1.js";import{C as Ie}from"./index.f2a4647f.js";import{u as it}from"./uniqBy.a5a2b368.js";import{u as rt}from"./index.afce2b0d.js";import{R as ct}from"./index.e4d5d044.js";const Ee=Symbol();function lt(e){return ke(e,Ee)}function ut(){return Ne(Ee)}const ft=Te({name:"BasicFormAction",components:{FormItem:$e.Item,Button:_e,BasicArrow:xe,[Ie.name]:Ie},props:{showActionButtonGroup:B.bool.def(!0),showResetButton:B.bool.def(!0),showSubmitButton:B.bool.def(!0),showAdvancedButton:B.bool.def(!0),resetButtonOptions:{type:Object,default:()=>({})},submitButtonOptions:{type:Object,default:()=>({})},actionColOptions:{type:Object,default:()=>({})},actionSpan:B.number.def(6),isAdvanced:B.bool,hideAdvanceBtn:B.bool},emits:["toggle-advanced"],setup(e,{emit:i}){const{t:o}=ze(),m=_(()=>{const{showAdvancedButton:c,actionSpan:u,actionColOptions:f}=e,v=24-u,w=c?{span:v<6?24:v}:{};return O(O({style:{textAlign:"right"},span:c?6:4},w),f)}),b=_(()=>Object.assign({text:o("common.resetText")},e.resetButtonOptions)),h=_(()=>Object.assign({text:o("common.queryText")},e.submitButtonOptions));function l(){i("toggle-advanced")}return O({t:o,actionColOpt:m,getResetBtnOptions:b,getSubmitBtnOptions:h,toggleAdvanced:l},ut())}});function dt(e,i,o,m,b,h){const l=Y("Button"),c=Y("BasicArrow"),u=Y("FormItem"),f=Y("a-col");return e.showActionButtonGroup?(q(),X(f,ae(ee({key:0},e.actionColOpt)),{default:x(()=>[Ye("div",{style:He([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[re(u,null,{default:x(()=>[H(e.$slots,"resetBefore"),e.showResetButton?(q(),X(l,ee({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:x(()=>[le(ue(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):se("",!0),H(e.$slots,"submitBefore"),e.showSubmitButton?(q(),X(l,ee({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:x(()=>[le(ue(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):se("",!0),H(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(q(),X(l,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:x(()=>[le(ue(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),re(c,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):se("",!0),H(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):se("",!0)}var mt=De(ft,[["render",dt]]);function pt(e,i,o){const m=/^\[(.+)\]$/;if(m.test(e)){const b=e.match(m);if(b&&b[1]){const h=b[1].split(",");return i=Array.isArray(i)?i:[i],h.forEach((l,c)=>{pe(o,l.trim(),i[c])}),!0}}}function bt(e,i,o){const m=/^\{(.+)\}$/;if(m.test(e)){const b=e.match(m);if(b&&b[1]){const h=b[1].split(",");return i=W(i)?i:{},h.forEach(l=>{pe(o,l.trim(),i[l.trim()])}),!0}}}function ht({defaultValueRef:e,getSchema:i,formModel:o,getProps:m}){function b(c){var f,v;if(!W(c))return{};const u={};for(const w of Object.entries(c)){let[,s]=w;const[j]=w;if(!j||te(s)&&s.length===0||ce(s))continue;const C=n(m).transformDateFunc;W(s)&&(s=C==null?void 0:C(s)),te(s)&&((f=s[0])==null?void 0:f.format)&&((v=s[1])==null?void 0:v.format)&&(s=s.map(M=>C==null?void 0:C(M))),ie(s)&&(s===""?s=void 0:s=s.trim()),!pt(j,s,u)&&!bt(j,s,u)&&pe(u,j,s)}return h(u)}function h(c){const u=n(m).fieldMapToTime;if(!u||!Array.isArray(u))return c;for(const[f,[v,w],s="YYYY-MM-DD"]of u){if(!f||!v||!w)continue;if(!c[f]){Reflect.deleteProperty(c,f);continue}const[j,C]=c[f],[M,p]=Array.isArray(s)?s:[s,s];c[v]=K(j).format(M),c[w]=K(C).format(p),Reflect.deleteProperty(c,f)}return c}function l(){const c=n(i),u={};c.forEach(f=>{const{defaultValue:v}=f;me(v)||(u[f.field]=v,o[f.field]===void 0&&(o[f.field]=v))}),e.value=G(u)}return{handleFormValues:b,initDefault:l}}const U=24;function yt({advanceState:e,emit:i,getProps:o,getSchema:m,formModel:b,defaultValueRef:h}){const l=We(),{realWidthRef:c,screenEnum:u,screenRef:f}=Ue(),v=_(()=>{if(!e.isAdvanced)return 0;const p=n(o).emptySpan||0;if(Ge(p))return p;if(W(p)){const{span:F=0}=p,N=n(f);return p[N.toLowerCase()]||F||0}return 0}),w=Ce(C,30);Q([()=>n(m),()=>e.isAdvanced,()=>n(c)],()=>{const{showAdvancedButton:p}=n(o);p&&w()},{immediate:!0});function s(p,F=0,N=!1){const L=n(c),$=parseInt(p.md)||parseInt(p.xs)||parseInt(p.sm)||p.span||U,V=parseInt(p.lg)||$,k=parseInt(p.xl)||V,t=parseInt(p.xxl)||k;return L<=u.LG?F+=$:L<u.XL?F+=V:L<u.XXL?F+=k:F+=t,N?(e.hideAdvanceBtn=!1,F<=U*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):F>U*2&&F<=U*(n(o).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:F}):F>U*(n(o).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:F}:{isAdvanced:!0,itemColSum:F}}const j=qe({});function C(){var L;let p=0,F=0;const{baseColProps:N={}}=n(o);for(const $ of n(m)){const{show:V,colProps:k}=$;let t=!0;if(Xe(V)&&(t=V),ce(V)&&(t=V({schema:$,model:b,field:$.field,values:O(O({},n(h)),b)})),t&&(k||N)){const{itemColSum:a,isAdvanced:g}=s(O(O({},N),k),p);p=a||0,g&&(F=p),j[$.field]=g}}(L=l==null?void 0:l.proxy)==null||L.$forceUpdate(),e.actionSpan=F%U+n(v),s(n(o).actionColOptions||{span:U},p,!0),i("advanced-change")}function M(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:M,fieldsIsAdvancedMap:j}}function At({emit:e,getProps:i,formModel:o,getSchema:m,defaultValueRef:b,formElRef:h,schemaRef:l,handleFormValues:c}){function u(){return D(this,null,function*(){const{resetFunc:t,submitOnReset:a}=n(i);t&&ce(t)&&(yield t()),n(h)&&(Object.keys(o).forEach(r=>{const d=n(m).find(E=>E.field===r),A=(d==null?void 0:d.component)&&ot.includes(d.component),I=G(b.value[r]);o[r]=A?I||"":I}),be(()=>$()),e("reset",ge(o)),a&&k())})}function f(t){return D(this,null,function*(){const a=n(m).map(A=>A.field).filter(Boolean),g=".",r=a.filter(A=>String(A).indexOf(g)>=0),d=[];Object.keys(t).forEach(A=>{const I=n(m).find(S=>S.field===A);let E=t[A];const ne=Reflect.has(t,A);E=st(I==null?void 0:I.component,E);const{componentProps:oe}=I||{};let R=oe;if(typeof oe=="function"&&(R=R({formModel:n(o)})),ne&&a.includes(A)){if(F(A))if(Array.isArray(E)){const S=[];for(const z of E)S.push(z?K(z):null);n(o)[A]=S}else n(o)[A]=E?R!=null&&R.valueFormat?E:K(E):null;else n(o)[A]=E;R!=null&&R.onChange&&(R==null||R.onChange(E)),d.push(A)}else r.forEach(S=>{try{const z=S.split(".").reduce((J,y)=>J[y],t);Be(z)&&(n(o)[S]=n(z),d.push(S))}catch(z){Be(b.value[S])&&(n(o)[S]=G(n(b.value[S])))}})}),N(d).catch(A=>{})})}function v(t){return D(this,null,function*(){const a=G(n(m));if(!t)return;let g=ie(t)?[t]:t;ie(t)&&(g=[t]);for(const r of g)w(r,a);l.value=a})}function w(t,a){if(ie(t)){const g=a.findIndex(r=>r.field===t);g!==-1&&(delete o[t],a.splice(g,1))}}function s(t,a,g=!1){return D(this,null,function*(){const r=G(n(m)),d=r.findIndex(I=>I.field===a),A=W(t)?[t]:t;if(!a||d===-1||g){g?r.unshift(...A):r.push(...A),l.value=r,M(t);return}d!==-1&&r.splice(d+1,0,...A),M(t),l.value=r})}function j(t){return D(this,null,function*(){let a=[];if(W(t)&&a.push(t),te(t)&&(a=[...t]),!a.every(r=>r.component==="Divider"||Reflect.has(r,"field")&&r.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}l.value=a})}function C(t){return D(this,null,function*(){let a=[];if(W(t)&&a.push(t),te(t)&&(a=[...t]),!a.every(d=>d.component==="Divider"||Reflect.has(d,"field")&&d.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const r=[];n(m).forEach(d=>{let A;if(a.forEach(I=>{d.field===I.field&&(A=I)}),A!==void 0&&d.field===A.field){const I=Ve(d,A);r.push(I)}else r.push(d)}),M(r),l.value=it(r,"field")})}function M(t){let a=[];W(t)&&a.push(t),te(t)&&(a=[...t]);const g={},r=p();a.forEach(d=>{d.component!="Divider"&&Reflect.has(d,"field")&&d.field&&!me(d.defaultValue)&&(!(d.field in r)||me(r[d.field])||Ke(r[d.field]))&&(g[d.field]=d.defaultValue)}),f(g)}function p(){return n(h)?c(ge(n(o))):{}}function F(t){return n(m).some(a=>a.field===t?je.includes(a.component):!1)}function N(t){return D(this,null,function*(){var a;return(a=n(h))==null?void 0:a.validateFields(t)})}function L(t){return D(this,null,function*(){var a;return yield(a=n(h))==null?void 0:a.validate(t)})}function $(t){return D(this,null,function*(){var a;yield(a=n(h))==null?void 0:a.clearValidate(t)})}function V(t,a){return D(this,null,function*(){var g;yield(g=n(h))==null?void 0:g.scrollToField(t,a)})}function k(t){return D(this,null,function*(){t&&t.preventDefault();const{submitFunc:a}=n(i);if(a&&ce(a)){yield a();return}if(!!n(h))try{const r=yield L(),d=c(r);e("submit",d)}catch(r){if((r==null?void 0:r.outOfDate)===!1&&(r==null?void 0:r.errorFields))return;throw new Error(r)}})}return{handleSubmit:k,clearValidate:$,validate:L,validateFields:N,getFieldsValue:p,updateSchema:C,resetSchema:j,appendSchemaByField:s,removeSchemaByField:v,resetFields:u,setFieldsValue:f,scrollToField:V}}function vt(b){return D(this,arguments,function*({getSchema:e,getProps:i,formElRef:o,isInitedDefault:m}){Je(()=>D(this,null,function*(){if(n(m)||!n(i).autoFocusFirstItem)return;yield be();const h=n(e),l=n(o),c=l==null?void 0:l.$el;if(!l||!c||!h||h.length===0||!h[0].component.includes("Input"))return;const f=c.querySelector(".ant-row:first-child input");!f||f==null||f.focus()}))})}const gt={model:{type:Object,default:()=>({})},labelWidth:{type:[Number,String],default:0},fieldMapToTime:{type:Array,default:()=>[]},compact:B.bool,schemas:{type:Array,default:()=>[]},mergeDynamicData:{type:Object,default:null},baseRowStyle:{type:Object},baseColProps:{type:Object},autoSetPlaceHolder:B.bool.def(!0),autoSubmitOnEnter:B.bool.def(!1),submitOnReset:B.bool,submitOnChange:B.bool,size:B.oneOf(["default","small","large"]).def("default"),disabled:B.bool,emptySpan:{type:[Number,Object],default:0},showAdvancedButton:B.bool,transformDateFunc:{type:Function,default:e=>{var i,o;return(o=(i=e==null?void 0:e.format)==null?void 0:i.call(e,"YYYY-MM-DD HH:mm:ss"))!=null?o:e}},rulesMessageJoinLabel:B.bool.def(!0),autoAdvancedLine:B.number.def(3),alwaysShowLines:B.number.def(1),showActionButtonGroup:B.bool.def(!0),actionColOptions:Object,showResetButton:B.bool.def(!0),autoFocusFirstItem:B.bool,resetButtonOptions:Object,showSubmitButton:B.bool.def(!0),submitButtonOptions:Object,resetFunc:Function,submitFunc:Function,hideRequiredMark:B.bool,labelCol:Object,layout:B.oneOf(["horizontal","vertical","inline"]).def("horizontal"),tableAction:{type:Object},wrapperCol:Object,colon:B.bool,labelAlign:B.string,rowProps:Object};const Bt=Te({name:"BasicForm",components:{FormItem:at,Form:$e,Row:ct,FormAction:mt},props:gt,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:i,attrs:o}){const m=we({}),b=rt(),h=we({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),l=Z({}),c=Z(!1),u=Z({}),f=Z(null),v=Z(null),{prefixCls:w}=Ze("basic-form"),s=_(()=>O(O({},e),n(u))),j=_(()=>[w,{[`${w}--compact`]:n(s).compact}]),C=_(()=>{const{baseRowStyle:y={},rowProps:T}=n(s);return O({style:y},T)}),M=_(()=>O(O(O({},o),e),n(s))),p=_(()=>{const y=n(f)||n(s).schemas;for(const T of y){const{defaultValue:P,component:he,isHandleDateDefaultValue:Re=!0}=T;if(Re&&P&&je.includes(he))if(!Array.isArray(P))T.defaultValue=K(P);else{const ye=[];P.forEach(Se=>{ye.push(K(Se))}),T.defaultValue=ye}}return n(s).showAdvancedButton?G(y.filter(T=>T.component!=="Divider")):G(y)}),{handleToggleAdvanced:F,fieldsIsAdvancedMap:N}=yt({advanceState:h,emit:i,getProps:s,getSchema:p,formModel:m,defaultValueRef:l}),{handleFormValues:L,initDefault:$}=ht({getProps:s,defaultValueRef:l,getSchema:p,formModel:m});vt({getSchema:p,getProps:s,isInitedDefault:c,formElRef:v});const{handleSubmit:V,setFieldsValue:k,clearValidate:t,validate:a,validateFields:g,getFieldsValue:r,updateSchema:d,resetSchema:A,appendSchemaByField:I,removeSchemaByField:E,resetFields:ne,scrollToField:oe}=At({emit:i,getProps:s,formModel:m,getSchema:p,defaultValueRef:l,formElRef:v,schemaRef:f,handleFormValues:L});lt({resetAction:ne,submitAction:V}),Q(()=>n(s).model,()=>{const{model:y}=n(s);!y||k(y)},{immediate:!0}),Q(()=>n(s).schemas,y=>{A(y!=null?y:[])}),Q(()=>p.value,y=>{be(()=>{var T;(T=b==null?void 0:b.redoModalHeight)==null||T.call(b)}),!n(c)&&y!=null&&y.length&&($(),c.value=!0)}),Q(()=>m,Ce(()=>{n(s).submitOnChange&&V()},300),{deep:!0});function R(y){return D(this,null,function*(){u.value=Ve(n(u)||{},y)})}function S(y,T,P){m[y]=T,i("field-value-change",y,T),P&&P.itemProps&&!P.itemProps.autoLink&&g([y]).catch(he=>{})}function z(y){const{autoSubmitOnEnter:T}=n(s);if(!!T&&y.key==="Enter"&&y.target&&y.target instanceof HTMLElement){const P=y.target;P&&P.tagName&&P.tagName.toUpperCase()=="INPUT"&&V()}}const J={getFieldsValue:r,setFieldsValue:k,resetFields:ne,updateSchema:d,resetSchema:A,setProps:R,removeSchemaByField:E,appendSchemaByField:I,clearValidate:t,validateFields:g,validate:a,submit:V,scrollToField:oe};return Qe(()=>{$(),i("register",J)}),O({getBindValue:M,handleToggleAdvanced:F,handleEnterPress:z,formModel:m,defaultValueRef:l,advanceState:h,getRow:C,getProps:s,formElRef:v,getSchema:p,formActionType:J,setFormModel:S,getFormClass:j,getFormActionBindProps:_(()=>O(O({},s.value),h)),fieldsIsAdvancedMap:N},J)}});function Ft(e,i,o,m,b,h){const l=Y("FormItem"),c=Y("FormAction"),u=Y("Row"),f=Y("Form");return q(),X(f,ee(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:nt(e.handleEnterPress,["enter"])}),{default:x(()=>[re(u,ae(de(e.getRow)),{default:x(()=>[H(e.$slots,"formHeader"),(q(!0),et(tt,null,fe(e.getSchema,v=>(q(),X(l,{key:v.field,isAdvanced:e.fieldsIsAdvancedMap[v.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:v,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},Oe({_:2},[fe(Object.keys(e.$slots),w=>({name:w,fn:x(s=>[H(e.$slots,w,ae(de(s||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),re(c,ee(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),Oe({_:2},[fe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],v=>({name:v,fn:x(w=>[H(e.$slots,v,ae(de(w||{})))])}))]),1040,["onToggleAdvanced"]),H(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}var St=De(Bt,[["render",Ft]]);export{St as B};
